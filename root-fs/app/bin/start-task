#!/bin/bash
set -o errexit
set -o nounset
set -o pipefail

check-database
if [ $? -ne 0 ]; then
	date > /data/maintenance
	run-installation
	if [ $? -ne 0 ]; then
		echo "Installation failed"
		exit 1
	fi
	rm /data/maintenance
else
	date > /data/maintenance
	#run-updates
	rm /data/maintenance
fi

echo ""
echo "#############################################"
echo "Starting TaskRunner"


##add Variables to Scripts
substitutePlaceholders /app/bin/config/backup_conf.json
substitutePlaceholders /app/bin/config/settings.php


echo "Starting runJobs"
/app/bin/parallel-runjobs-service \
--config /app/bin/config/runJobs_conf.yaml \
	&


echo "Starting ProcessRunner"
/app/bin/parallel-processRunner &

sleep inf
